generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id          String    @id @default(cuid())
  slug        String    @unique
  name        String
  description String?
  products    Product[]

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id               String    @id @default(cuid())
  slug             String    @unique
  name             String
  shortDescription String
  description      String
  price            Int
  tag              String?
  image            String
  isFeatured       Boolean   @default(false)
  isActive         Boolean   @default(true)

  // 游 control de stock
  stock            Int       @default(0)
  trackStock       Boolean   @default(false)

  // relaci칩n con categor칤a
  categoryId       String
  category         Category  @relation(fields: [categoryId], references: [id])

  // 游 relaciones
  sales            ProductSale[]
  favorites        Favorite[]
  reviews          Review[]
  images           ProductImage[]

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model ProductSale {
  id         String   @id @default(cuid())
  productId  String
  product    Product  @relation(fields: [productId], references: [id])

  quantity   Int
  totalPrice Int      // price * quantity (en COP)

  createdAt  DateTime @default(now())
}

// 游 Sistema de favoritos (usa sessionId para usuarios an칩nimos)
model Favorite {
  id        String   @id @default(cuid())
  sessionId String   // Cookie o localStorage ID del usuario
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([sessionId, productId])
  @@index([sessionId])
}

// 游 Sistema de rese침as y calificaciones
model Review {
  id         String   @id @default(cuid())
  productId  String
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  authorName String
  rating     Int      // 1-5 estrellas
  comment    String?
  isApproved Boolean  @default(false) // moderaci칩n

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([productId])
  @@index([isApproved])
}

// 游 Galer칤a de im치genes adicionales por producto
model ProductImage {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  url       String
  order     Int      @default(0) // orden de visualizaci칩n
  alt       String?

  createdAt DateTime @default(now())

  @@index([productId])
}

// 游 Sistema de cupones/descuentos
model Coupon {
  id          String    @id @default(cuid())
  code        String    @unique
  type        String    // "percentage" | "fixed"
  value       Int       // porcentaje (10 = 10%) o valor fijo en COP
  minPurchase Int?      // compra m칤nima para aplicar (opcional)
  maxUses     Int?      // n칰mero m치ximo de usos (opcional)
  usedCount   Int       @default(0)
  isActive    Boolean   @default(true)
  expiresAt   DateTime?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([code])
  @@index([isActive])
}

// 游 Suscriptores de email marketing
model EmailSubscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

// 游 Banners del carousel principal
model Banner {
  id          String   @id @default(cuid())
  title       String
  subtitle    String?
  description String?
  imageUrl    String
  buttonText  String?
  buttonLink  String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([order])
}
